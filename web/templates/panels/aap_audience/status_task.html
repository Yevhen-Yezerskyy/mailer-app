<!-- FILE: web/templates/panels/aap_audience/status_task.html -->
<!-- DATE: 2025-12-29 -->
<!-- Смысл:
- Стандартная разметка как в how.html
- Верхняя таблица: две колонки (Колонка 1 / Колонка 2)
- Нижняя таблица: заглушка "тут будет таблица"
-->

{% extends "panels/base.html" %}
{% load i18n %}

{% block content %}

<!-- TOP TABLE -->
<table class="YY-MAIN_TABLE">
  <tr>
    <td class="YY-MAIN_TOP_LEFT_TD w-1/2">
      <div class="YY-CARD_WHITE">
        {% if t.type == "sell" %}
          <div class="YY-STATUS_GREEN mb-2">
              {% trans "Поиск клиентов" %}
          </div>
        {% else %}
          <div class="YY-STATUS_YELLOW mb-2">
              {% trans "Поиск поставщиков / подрядчиков" %}
        </div>
        {% endif %}

         <div class="YY-LABEL mb-12">
          {{ t.title }}
         </div>

        <div class="YY-STATUS_GREEN w-full mb-2">
          {% trans "Контакты: присвоен рейтинг" %}: {{ contacts_rated }}
        </div>

        <div class="YY-STATUS_GRAY w-full mb-2">
          {% trans "Всего собрано контактов" %}: {{ contacts_total }}
        </div>

        <div class="YY-STATUS_YELLOW w-full mb-12">
          {% trans "Ограничение на рейтингование" %}: {{ t.subscribers_limit }}
        </div>

        <a href="../" class="YY-BUTTON_MAIN">
          {% trans "Вернуться к аудиториям" %}
        </a>

      </div>
    </td>

    <td class="YY-MAIN_TOP_RIGHT_TD w-1/2">
      <div class="YY-CARD_WHITE">

          {% if not contacts_rating_exists %}
            <div class="YY-STATUS_YELLOW w-full mb-2">
              {% trans "Рейтингование контактов не запущено" %}
            </div>

            <form method="post">
              {% csrf_token %}
              <button type="submit" name="action" value="rating_start_contacts" class="YY-BUTTON_MAIN w-full">
                {% trans "Запустить рейтингование" %}
              </button>
            </form>
          {% else %}
            <div class="YY-STATUS_GREEN w-full mb-2">
              {% trans "Рейтингование контактов запущено" %}
            </div>
          {% endif %}

      </div>
    </td>
  </tr>
</table>

<!-- BOTTOM TABLE -->
<table class="YY-MAIN_TABLE">
  <tr>
    <td class="YY-MAIN_BOTTOM_TD">

      <div data-tabs="contacts">

          <div class="flex gap-3 mb-3">
            <button type="button"
              data-tab="rated"
              data-active-class="YY-BUTTON_GREEN"
              data-idle-class="YY-BUTTON_MAIN"
              class="{% if tab == 'rated' %}YY-BUTTON_GREEN{% else %}YY-BUTTON_MAIN{% endif %}">
              {% trans "Контакты: присвоен рейтинг" %}
            </button>

            <button type="button"
              data-tab="all"
              data-active-class="YY-BUTTON_GREEN"
              data-idle-class="YY-BUTTON_MAIN"
              class="{% if tab == 'all' %}YY-BUTTON_GREEN{% else %}YY-BUTTON_MAIN{% endif %}">
              {% trans "Контакты: все собранные" %}
            </button>
          </div>

          <!-- RATED -->
        <div class="YY-MAIN_BOTTOM_DIV">
          <div data-panel="rated" class="{% if tab != 'rated' %}hidden{% endif %}">
            {% if rated_rows %}
              <table class="w-full text-left">
                <thead>
                  <tr class="YY-TH_TR">
                    <th class="YY-TH_TH">{% trans "Компания" %}</th>
                    <th class="YY-TH_TH">{% trans "Категории" %}</th>
                    <th class="YY-TH_TH">{% trans "Адрес" %}</th>
                    <th class="YY-TH_TH">{% trans "CB" %}</th>
                    <th class="YY-TH_TH">{% trans "CL" %}</th>
                    <th class="YY-TH_TH">{% trans "Смотреть" %}</th>
                  </tr>
                </thead>
                <tbody>
                  {% for it in rated_rows %}
                    <tr class="YY-TB_TR align-top">
                      <td class="YY-TB_TD">{{ it.company_name }}</td>
                      <td class="YY-TB_TD">{{ it.branches_str }}</td>
                      <td class="YY-TB_TD">{{ it.address_first }}</td>
                      <td class="YY-TB_TD">{{ it.rate_cb_100 }}</td>
                      <td class="YY-TB_TD">{{ it.rate_cl }}</td>
                      <td class="YY-TB_TD">
                        <a href="#" class="YY-BUTTON_TAB_MAIN">{% trans "Смотреть" %}</a>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>

              <div class="flex gap-3 mt-3 items-center">
                {% if rated_page > 1 %}
                  <a class="YY-BUTTON_MAIN"
                    href="?id={{ request.GET.id }}&tab=rated&p_rated={{ rated_page|add:"-1" }}&p_all={{ all_page }}">
                    {% trans "Назад" %}
                  </a>
                {% endif %}

                <div class="YY-TEXT">
                  {{ rated_page }} / {{ rated_pages }}
                </div>

                {% if rated_page < rated_pages %}
                  <a class="YY-BUTTON_MAIN"
                    href="?id={{ request.GET.id }}&tab=rated&p_rated={{ rated_page|add:"1" }}&p_all={{ all_page }}">
                    {% trans "Вперёд" %}
                  </a>
                {% endif %}
              </div>
            {% else %}
              <div class="YY-CARD_WHITE">
                {% trans "Здесь пока нет данных" %}
              </div>
            {% endif %}
          </div>

          <!-- ALL -->
          <div data-panel="all" class="{% if tab != 'all' %}hidden{% endif %}">
            {% if all_rows %}
              <table class="w-full text-left">
                <thead>
                  <tr class="YY-TH_TR">
                    <th class="YY-TH_TH">{% trans "Компания" %}</th>
                    <th class="YY-TH_TH">{% trans "Категории" %}</th>
                    <th class="YY-TH_TH">{% trans "Адрес" %}</th>
                    <th class="YY-TH_TH">{% trans "CB" %}</th>
                    <th class="YY-TH_TH">{% trans "Смотреть" %}</th>
                  </tr>
                </thead>
                <tbody>
                  {% for it in all_rows %}
                    <tr class="YY-TB_TR align-top">
                      <td class="YY-TB_TD">{{ it.company_name }}</td>
                      <td class="YY-TB_TD">{{ it.branches_str }}</td>
                      <td class="YY-TB_TD">{{ it.address_first }}</td>
                      <td class="YY-TB_TD">{{ it.rate_cb_100 }}</td>
                      <td class="YY-TB_TD">
                        <a href="#" class="YY-BUTTON_TAB_MAIN">{% trans "Смотреть" %}</a>
                      </td>
                    </tr>
                  {% endfor %}
                </tbody>
              </table>

              <div class="flex gap-3 mt-3 items-center">
                {% if all_page > 1 %}
                  <a class="YY-BUTTON_MAIN"
                    href="?id={{ request.GET.id }}&tab=all&p_rated={{ rated_page }}&p_all={{ all_page|add:"-1" }}">
                    {% trans "Назад" %}
                  </a>
                {% endif %}

                <div class="YY-TEXT">
                  {{ all_page }} / {{ all_pages }}
                </div>

                {% if all_page < all_pages %}
                  <a class="YY-BUTTON_MAIN"
                    href="?id={{ request.GET.id }}&tab=all&p_rated={{ rated_page }}&p_all={{ all_page|add:"1" }}">
                    {% trans "Вперёд" %}
                  </a>
                {% endif %}
              </div>
          </div>
            {% else %}
              <div class="YY-CARD_WHITE">
                {% trans "Здесь пока нет данных" %}
              </div>
            {% endif %}
          </div>
        </div>
        </div>

















      </div>
    </td>
  </tr>
</table>

{% endblock %}
