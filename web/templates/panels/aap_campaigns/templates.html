<!-- FILE: web/templates/panels/aap_campaigns/templates.html -->
<!-- DATE: 2026-01-14 -->
<!-- PURPOSE: CRUD + User-editor (Quill only). -->
<!-- CHANGE: HTML и CSS раздельно: Quill редактирует только HTML, CSS живёт отдельным live <style>. -->

{% extends "panels/base.html" %}
{% load i18n %}

{% block content %}

<table class="YY-MAIN_TABLE">
  <tr>
    <td class="YY-MAIN_TOP_LEFT_TD w-1/2">
      <div class="YY-CARD_WHITE">

        {% if state == "edit" and edit_obj or state == "add" %}
          <div class="YY-STATUS_GREEN mb-5">
            {% if state == "edit" %}{% trans "Редактирование шаблона" %}{% else %}{% trans "Новый шаблон" %}{% endif %}
          </div>

          <form method="post" id="yyTplForm">
            {% csrf_token %}
            {% if edit_obj %}
              <input type="hidden" name="id" value="{{ edit_obj.ui_id }}">
            {% endif %}

            <label class="YY-LABEL">{% trans "Название" %}</label>
            <input type="text" name="template_name" class="YY-INPUT w-full"
                   value="{{ edit_obj.template_name|default:'' }}">

            <div class="YY-STATUS_BLUE mt-4 mb-2">
              {% trans "Редактор" %}
            </div>

            <div id="yyQuillStyleHost"></div>
            <div id="yyQuillEditor" class="YY-CARD_WHITE" style="min-height:320px;"></div>

            <input type="hidden" name="editor_html" id="yyEditorHtml">
            <input type="hidden" name="css_text" id="yyCssText">

            <div class="flex gap-3 mt-4">
              <button type="submit" name="action"
                      value="{% if state == 'edit' %}save{% else %}add{% endif %}"
                      class="YY-BUTTON_MAIN">
                {% trans "Сохранить" %}
              </button>

              <button type="submit" name="action" value="close"
                      class="YY-BUTTON_MAIN" formnovalidate>
                {% trans "Закрыть" %}
              </button>
            </div>
          </form>
        {% else %}
          <div class="YY-STATUS_GREEN mb-5">
            {% trans "Шаблоны писем" %}
          </div>

          <a href="?state=add" class="YY-BUTTON_MAIN">
            {% trans "Добавить новый шаблон" %}
          </a>
        {% endif %}

      </div>
    </td>

    <td class="YY-MAIN_TOP_RIGHT_TD w-1/2">
      <div class="YY-CARD_WHITE">
        <div class="YY-STATUS_BLUE">
          {% trans "Шаблоны (workspace)" %}
        </div>
      </div>
    </td>
  </tr>
</table>

<table class="YY-MAIN_TABLE">
  <tr>
    <td class="YY-MAIN_BOTTOM_TD">
      {% if items %}
        <table class="w-full text-left">
          <thead>
            <tr class="YY-TH_TR">
              <th class="YY-TH_TH w-[70%]">{% trans "Название" %}</th>
              <th class="YY-TH_TH">&nbsp;</th>
            </tr>
          </thead>
          <tbody>
            {% for it in items %}
              <tr class="YY-TB_TR">
                <td class="YY-TB_TD">
                  <div class="YY-STATUS_BLUE">{{ it.template_name }}</div>
                </td>
                <td class="YY-TB_TD">
                  <a href="?state=edit&id={{ it.ui_id }}" class="YY-BUTTON_TAB_MAIN mb-2">
                    {% trans "Изменить" %}
                  </a>
                  <form method="post" onsubmit="return confirm('{% trans "Вы уверены?" %}');">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="delete">
                    <input type="hidden" name="id" value="{{ it.ui_id }}">
                    <button type="submit" class="YY-BUTTON_TAB_RED">
                      {% trans "Удалить" %}
                    </button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}
    </td>
  </tr>
</table>

{% endblock %}

{% block extra_js %}
  {{ block.super }}
  <link rel="stylesheet" href="/static/vendor/quill/quill.snow.css">
  <script src="/static/vendor/quill/quill.min.js"></script>
  <script src="/static/js/campaign_templates_editor.js"></script>
{% endblock %}
