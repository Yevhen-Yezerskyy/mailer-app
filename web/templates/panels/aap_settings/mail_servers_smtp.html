{% extends "panels/base.html" %}
{% load i18n %}
{% load static %}
<!-- FILE: web/templates/panels/aap_settings/mail_servers_list.html  (обновлено — 2026-01-23) -->
<!-- PURPOSE: Settings → Mail servers: список mailbox + добавление (только email) + удаление. -->
<!-- CHANGE: убраны "Отправитель" и "Лимит/час" (они живут в SMTP). Кнопки разнесены по отдельным колонкам. -->

{% block content %}

<table class="YY-MAIN_TABLE">
  <tr>
    <td class="YY-MAIN_TOP_LEFT_TD w-[60%]">
      <div class="YY-CARD_WHITE">

        {% if form.non_field_errors %}
          <div class="YY-CARD_IN_FORM_ERROR mb-3">{{ form.non_field_errors }}</div>
        {% endif %}

        <div class="YY-STATUS_BLUE mb-3">{% trans "Добавить почтовый сервер" %}</div>

        <form method="post" class="mb-8">
          {% csrf_token %}
          <div class="grid grid-cols-[2fr_auto] gap-3 items-end">
            <div>
              <label class="YY-LABEL">Email:</label>
              {{ form.email }}
              {% if form.email.errors %}
                <div class="YY-FORM_ERROR mt-1">{{ form.email.errors }}</div>
              {% endif %}
            </div>
            <div>
              <button type="submit" name="action" value="add" class="YY-BUTTON_MAIN">
                {% trans "Добавить" %}
              </button>
            </div>
          </div>
        </form>

        <div class="YY-STATUS_BLUE mb-3">{% trans "Ваши почтовые серверы:" %}</div>

        <div class="overflow-x-auto">
          <table class="YY-TABLE w-full">
            <thead>
              <tr>
                <th class="text-left py-2">Email</th>
                <th class="text-left py-2">SMTP</th>
                <th class="text-left py-2">IMAP</th>
                <th class="text-left py-2">{% trans "Изменить" %}</th>
                <th class="text-left py-2">{% trans "Удалить" %}</th>
              </tr>
            </thead>
            <tbody>
              {% for it in items %}
                <tr class="border-t">
                  <td class="py-2">{{ it.email }}</td>

                  <td class="py-2">
                    <a class="YY-BUTTON_TAB_MAIN !py-2 !px-3" href="{% url 'settings:mail_servers_smtp' it.ui_id %}">SMTP</a>
                  </td>

                  <td class="py-2">
                    <a class="YY-BUTTON_TAB_MAIN !py-2 !px-3" href="{% url 'settings:mail_servers_imap' it.ui_id %}">IMAP</a>
                  </td>

                  <td class="py-2">
                    <a class="YY-BUTTON_TAB_MAIN !py-2 !px-3" href="{% url 'settings:mail_servers_smtp' it.ui_id %}">
                      {% trans "Изменить" %}
                    </a>
                  </td>

                  <td class="py-2">
                    <form method="post" class="inline" onsubmit="return confirm('{% trans "Вы уверены?" %}');">
                      {% csrf_token %}
                      <input type="hidden" name="id" value="{{ it.ui_id }}">
                      <button type="submit" name="action" value="delete" class="YY-BUTTON_TAB_RED !py-2 !px-3">
                        {% trans "Удалить" %}
                      </button>
                    </form>
                  </td>
                </tr>
              {% empty %}
                <tr class="border-t">
                  <td class="py-3 text-gray-500" colspan="5">{% trans "Пока нет ящиков." %}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    </td>

    <td class="YY-MAIN_TOP_RIGHT_TD w-[40%]">
      <div class="YY-CARD_WHITE">
        <div class="YY-STATUS_BLUE">{% trans "SMTP и IMAP настраиваются отдельно на следующих шагах." %}</div>
      </div>
    </td>
  </tr>
</table>

{% endblock %}
