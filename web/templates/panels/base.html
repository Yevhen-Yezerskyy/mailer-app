{% load static %}
{% load i18n %}
<!doctype html>
<html lang="ru">
<!-- FILE: web/templates/panels/base.html  (обновлено — 2025-12-18)
Смысл: base панели: фикс-высота + scroll контента, toggle sidebar (js), favicon, logout в topbar -->

<head>
  <meta charset="utf-8">
  <title>{{ page_title|default:"" }} - Serenity Mailer</title>

  <!-- 00.00 /panel/ BASE: favicon -->
  <link rel="icon" href="{% static 'img/favicon.ico' %}" />

  <!-- 00.01 /panel/ BASE: Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- 00.02 /panel/ BASE: наши стили поверх -->
  <link rel="stylesheet" href="{% static 'css/panel.css' %}">
</head>

<body class="min-h-screen bg-slate-100">

  <!-- 00.10 /panel/ ROOT LAYOUT -->
  <div class="h-screen flex overflow-hidden">

    <!-- ========================================================= -->
    <!-- 01.00 /panel/ SIDEBAR (LEFT)                               -->
    <!-- ========================================================= -->
    <aside id="panel-sidebar" class="w-72 shrink-0 bg-white border-r border-slate-200 flex flex-col">

      <!-- 01.01 /panel/ SIDEBAR HEADER / LOGO -->
      <div class="h-16 px-6 flex items-center border-b border-slate-200 justify-center">
        <a href="/"><img src="{% static 'img/logo.main.svg' %}" alt="Serenity" class="h-6 w-auto"></a>
      </div>

      <!-- 01.02 /panel/ SIDEBAR NAVIGATION -->
      <nav class="p-4 space-y-3 text-[15px]">

        {% for sec in panel_menu %}
          <details {% if sec.open %}open{% endif %} class="rounded-lg border border-slate-200 bg-[#effbff]">
            <summary class="cursor-pointer select-none px-4 py-3 font-semibold text-[#006991] hover:bg-[#e3f6fb] rounded-lg">
              {{ sec.title }}
            </summary>

            <div class="px-2 pb-2">
              {% for it in sec.items %}
                <a href="{{ it.url }}"
                   class="block px-3 py-2 rounded-md hover:bg-white {% if it.active %}bg-white font-semibold{% endif %}">
                  {{ it.title }}
                </a>
              {% endfor %}
            </div>
          </details>
        {% endfor %}

      </nav>

      <!-- 01.90 /panel/ SIDEBAR FOOTER / USER -->
      <div class="mt-auto p-4 border-t border-slate-200 text-xs text-slate-500">
        {% if request.user.is_authenticated %}
          {{ request.user.username }}
        {% endif %}
      </div>

    </aside>

    <!-- ========================================================= -->
    <!-- 02.00 /panel/ MAIN AREA                                   -->
    <!-- ========================================================= -->
    <div class="flex-1 min-w-0 min-h-0 flex flex-col">

      <!-- ========================================================= -->
      <!-- 02.01 /panel/ TOPBAR                                      -->
      <!-- ========================================================= -->
      <header class="h-16 bg-white border-b border-slate-200 flex items-center px-6">

        <!-- 02.01.01 /panel/topbar/sidebar-toggle -->
        <button
          type="button"
          data-sidebar-toggle
          class="mr-4 px-3 h-9 flex items-center justify-center
                rounded-lg bg-[#effbff] text-[#006991] font-semibold
                hover:bg-[#e3f6fb] border border-slate-200">
          ☰
        </button>

        <!-- 02.01.02 /panel/topbar/title -->
        <div class="flex-1">
          <span class="text-[#006991] font-semibold uppercase">
            {{ page_title|default:"" }}
          </span>
        </div>

        <!-- 02.01.03 /panel/topbar/user -->
        <div class="mr-5 text-[#006991] font-semibold text-sm">
          {% if request.user.is_authenticated %}
            {{ request.user.username }}
          {% endif %}
        </div>

        <!-- 02.01.04 /panel/topbar/logout -->
        <form method="post" action="{% url 'logout' %}" class="inline">
          {% csrf_token %}
          <button
            type="submit"
            class="ml-4 px-4 h-9 flex items-center justify-center
                  rounded-lg bg-[#effbff] text-[#006991] font-semibold
                  hover:bg-[#e3f6fb] border border-slate-200">
            {% trans "Выйти" %}
          </button>
        </form>

      </header>

      <!-- 02.10 /panel/ CONTENT (scroll only here) -->
      <main class="flex-1 min-h-0 p-6 overflow-y-auto">
        {% block content %}{% endblock %}
      </main>

    </div>

  </div>

  <!-- ========================================================= -->
  <!-- 99.00 /panel/ SCRIPTS                                      -->
  <!-- ========================================================= -->
  <script>
    (function () {
      const btn = document.querySelector('[data-sidebar-toggle]');
      const sidebar = document.getElementById('panel-sidebar');
      if (!btn || !sidebar) return;

      btn.addEventListener('click', function () {
        sidebar.classList.toggle('hidden');
      });
    })();
  </script>

</body>
</html>
